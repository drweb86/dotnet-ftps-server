<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:FtpsServerAvalonia"
             xmlns:controls="using:FtpsServerAvalonia.Controls"
             xmlns:res="using:FtpsServerAvalonia.Resources"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="FtpsServerAvalonia.Views.AndroidView"
             Background="{StaticResource PrimaryDarkBrush}">

    <UserControl.Styles>
        <Style Selector="MenuItem">
            <Setter Property="FontSize" Value="16" />
        </Style>

        <Style Selector="RadioButton.TabButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="RadioButton.TabButton:checked">
            <Setter Property="Background" Value="{StaticResource TertiaryDarkBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource AccentCyanBrush}"/>
        </Style>
        <Style Selector="RadioButton.TabButton:pointerover">
            <Setter Property="Background" Value="{StaticResource TertiaryDarkBrush}"/>
        </Style>

        <!-- Expander Styles for collapsible sections -->
        <Style Selector="Expander.SectionExpander">
            <Setter Property="Background" Value="{StaticResource TertiaryDarkBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentCyanBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="10,0,10,20"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Expander.SectionExpander /template/ ToggleButton#PART_toggle">
            <Setter Property="Padding" Value="16"/>
        </Style>
    </UserControl.Styles>

	<ScrollViewer x:Name="MainScrollViewer" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" HorizontalAlignment="Stretch">
		<StackPanel x:Name="ContentPanel" HorizontalAlignment="Stretch">
			<controls:MainMenuControl
				x:Name="MainMenu"
				DockPanel.Dock="Top"
				StartStopClicked="MainMenu_StartStopClicked" />

			<Border x:Name="ErrorBanner"
					Background="#D32F2F"
					Padding="12,8"
					Margin="10,5,10,5"
					CornerRadius="4"
					IsVisible="False">
				<Grid ColumnDefinitions="*,Auto">
					<TextBlock x:Name="ErrorText"
							   Grid.Column="0"
							   Foreground="White"
							   FontSize="14"
							   TextWrapping="Wrap"
							   VerticalAlignment="Center"/>
					<Button Grid.Column="1"
							Content="X"
							Background="Transparent"
							Foreground="White"
							FontWeight="Bold"
							Padding="8,4"
							Margin="8,0,0,0"
							Click="DismissError_Click"/>
				</Grid>
			</Border>

			<controls:UpdateCheckExpanderView />

			<!-- Host, Port, Certificate Section (Collapsible) -->
			<Expander Classes="SectionExpander" IsExpanded="True">
				<Expander.Header>
					<TextBlock Text="{x:Static res:Strings.ConfigTitle}"
							   FontSize="18"
							   FontWeight="SemiBold"
							   Foreground="{StaticResource TextPrimaryBrush}"/>
				</Expander.Header>
				<controls:ServerConfigurationControl
					x:Name="ServerConfig"
					ShowTitle="False"
					BorderThickness="0"
					Margin="0"
					Port="{Binding Port, Mode=TwoWay}"
					MaxConnections="{Binding MaxConnections, Mode=TwoWay}"
					CertificateSource="{Binding CertificateSource, Mode=TwoWay}"
					CertificatePath="{Binding CertificatePath, Mode=TwoWay}"
					CertificatePassword="{Binding CertificatePassword, Mode=TwoWay}" />
			</Expander>

			<!-- Users Section (Collapsible) -->
			<Expander Classes="SectionExpander" IsExpanded="True">
				<Expander.Header>
					<Grid HorizontalAlignment="Stretch">
						<TextBlock Text="{x:Static res:Strings.UsersTab}"
								   FontSize="18"
								   FontWeight="SemiBold"
								   Foreground="{StaticResource TextPrimaryBrush}"
								   HorizontalAlignment="Left"
								   VerticalAlignment="Center"/>
					</Grid>
				</Expander.Header>
				<StackPanel Margin="0,8,0,0">
					<Button Content="{x:Static res:Strings.AddUserButton}"
							Classes="SecondaryButton"
							HorizontalAlignment="Right"
							Click="AddUser_Click"
							Padding="16,8"
							Margin="0,0,0,16"/>

					<ItemsControl x:Name="UsersItemsControl">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<controls:UserItemControl RemoveUserRequested="UserItemControl_RemoveUserRequested"/>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>
			</Expander>

			<!-- Server Logs Section (Collapsible) -->
			<Expander Classes="SectionExpander" IsExpanded="False">
				<Expander.Header>
					<Grid HorizontalAlignment="Stretch">
						<TextBlock Text="{x:Static res:Strings.LogsTab}"
								   FontSize="18"
								   FontWeight="SemiBold"
								   Foreground="{StaticResource TextPrimaryBrush}"
								   HorizontalAlignment="Left"
								   VerticalAlignment="Center"/>
					</Grid>
				</Expander.Header>
				<StackPanel Margin="0,8,0,0">
					<Button Content="{x:Static res:Strings.ClearLogs}"
							Classes="SecondaryButton"
							HorizontalAlignment="Right"
							Click="ClearLogs_Click"
							Padding="16,8"
							Margin="0,0,0,8"/>

					<Border Background="{StaticResource PrimaryDarkBrush}"
							CornerRadius="4"
							Padding="8"
							MinHeight="200"
							MaxHeight="400">
						<ScrollViewer x:Name="LogScrollViewer"
									  VerticalScrollBarVisibility="Auto"
									  HorizontalScrollBarVisibility="Auto">
							<ItemsControl x:Name="LogItemsControl">
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding FormattedMessage}"
												   Foreground="{Binding Color}"
												   FontFamily="Consolas, Courier New, monospace"
												   FontSize="12"
												   Margin="0,2"/>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</ScrollViewer>
					</Border>
				</StackPanel>
			</Expander>
		</StackPanel>
	</ScrollViewer>
</UserControl>
